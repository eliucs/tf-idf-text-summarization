"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),fs=require("fs"),natural=require("natural"),Tokenizer=require("sentence-tokenizer"),_require=require("porter-stemmer"),stemmer=_require.stemmer,TextSummarizer=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"_isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"_convertToVector",value:function(e){var r={};return e.forEach(function(e){r[e]?r[e].count++:r[e]={count:1}}),r}},{key:"summarize",value:function(r,t){var n=new natural.WordTokenizer,o=new Tokenizer;o.setEntry(r);var a=n.tokenize(r);a=a.filter(function(r){return r.match(/[a-z]/i)&&!e._isNumber(r)}).map(function(e){return stemmer(e.toLowerCase())});var c=e._convertToVector(a),u=o.getSentences().map(function(r,t){return{original:r,vector:e._convertToVector(n.tokenize(r).filter(function(r){return r.match(/[a-z]/i)&&!e._isNumber(r)}).map(function(e){return stemmer(e.toLowerCase())})),index:t}});u.forEach(function(e){var r=Object.keys(e.vector);e.keys=r,r.forEach(function(r){e.vector[r].weight=1+Math.log10(e.vector[r].count)})});var i=Object.keys(c),f=i.length,s={};i.forEach(function(e){s[e]=0,u.forEach(function(r){r.vector[e]&&s[e]++}),s[e]=Math.log10(f/s[e]),c[e].tfIdf=(1+Math.log10(c[e].count))*s[e]});var m=Math.sqrt(i.map(function(e){return c[e].tfIdf}).reduce(function(e,r){return e+Math.pow(r,2)},0));return u.forEach(function(e){var r=0,t=0;e.keys.forEach(function(n){e.vector[n].tfIdf=e.vector[n].weight*s[n],t+=e.vector[n].tfIdf*c[n].tfIdf,r+=Math.pow(e.vector[n].tfIdf,2)}),(r=Math.sqrt(r))?(e.theta=Math.acos(t/(r*m)),e.score=(Math.acos(0)-e.theta)/Math.acos(0)):(e.theta=0,e.score=0)}),u.filter(function(e){return e.score>=t}).map(function(e){return e.original}).join("\n")}},{key:"summarizeAsync",value:function(r,t,n){try{var o=e.summarize(r);return n(o,void 0)}catch(e){return n(void 0,e)}}},{key:"summarizeAsyncPromise",value:function(r,t){return new Promise(function(t,n){try{return t(e.summarize(r))}catch(e){return n(e)}})}}]),e}();module.exports={TextSummarizer:TextSummarizer};